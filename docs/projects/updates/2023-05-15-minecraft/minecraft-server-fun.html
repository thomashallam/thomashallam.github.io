<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.543">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Thomas Hallam">
<meta name="dcterms.date" content="2023-05-15">

<title>User Research, User-Centred Design, User Experience - Managing a Minecraft server maze</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EMB22EEKPF"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EMB22EEKPF', { 'anonymize_ip': false});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">User Research, User-Centred Design, User Experience</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Tom’s blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">Hello</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../resources/links.html"> 
<span class="menu-text">Useful links</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../projects/projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/thomashallam"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/thomashallam"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/thomashallam"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Managing a Minecraft server maze</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Childcare</div>
    <div class="quarto-category">Minecraft</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Thomas Hallam </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 15, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="being-ok-with-many-hats" class="level1">
<h1>Being ok with many hats</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="bedroom-rotating-saw.png" class="img-fluid figure-img"></p>
<figcaption>Your friendly local diy fan</figcaption>
</figure>
</div>
<section id="context" class="level2">
<h2 class="anchored" data-anchor-id="context">Context</h2>
<p>I had a very busy weekend with my kids. Climbing, swimming, biking, footballing, bbqing, Minecrafting, tidying, gardening, entertaining, cooking. Exhausting! What’s worse I hardly sleeping with so much stress and work and outside work too.</p>
<p>Anyhow, my kids are now totally immersed in Minecraft (1.19.4 java edition). Most their friends are too, and they all want to play together.</p>
<p>We’ve previous used the ‘Join on Lan’ feature but this is reliant on the host always being connected, we’ve explored hosting options, e.g.&nbsp;using old Linux laptop (too slow / 32bit), buying a server (too expensive), or using a third-party tool (Curseforge, MultiMC). Some are ok, but none have been ideal.</p>
<p>In the latest attempt to get a reliable server working for the local network, I’ve tried the Windows 11 VM tool. It works for now, as many of their mc friends can join the network. It isn’t reliant on external hosting on a third party server/website, and less problems with online chat.</p>
<p>This took quite a bit of reading around various articles, testing the options, but here is a working set-up!</p>
<p>Hope you enjoy it.</p>
<hr>
</section>
</section>
<section id="install-and-run-minecraft-server-1.19.4-for-local-network-access-on-windows-vm-hypervisor-ubuntu-22.04---step-by-step-guide" class="level1">
<h1>Install and run Minecraft Server 1.19.4 for local network access on Windows VM HyperVisor Ubuntu 22.04 - Step-by-step guide</h1>
</section>
<section id="index" class="level1">
<h1>Index:</h1>
<ul>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#ubuntu-live-server">Ubuntu Live Server</a></li>
<li><a href="#ssh">SSH</a></li>
<li><a href="#create-new-root-account">Create new root account</a></li>
<li><a href="#system-hardening">System hardening</a></li>
<li><a href="#ubuntu-firewall">Ubuntu firewall</a></li>
<li><a href="#java">Java</a></li>
<li><a href="#minecraft-server">Minecraft Server</a></li>
<li><a href="#supervisor">Supervisor</a></li>
<li><a href="#screens">Screens</a></li>
<li><a href="#test-it-works">Test it works</a></li>
<li><a href="#internet-server">Internet server</a></li>
</ul>
<hr>
<section id="system-setup" class="level2">
<h2 class="anchored" data-anchor-id="system-setup">System Setup</h2>
<section id="dependencies" class="level3">
<h3 class="anchored" data-anchor-id="dependencies">Dependencies</h3>
<ul>
<li>8gb+ RAM</li>
<li>Enough HDD memory</li>
<li>Installation of Windows 10 or 11</li>
<li>Install WSL2</li>
<li>Enable Windows Developer features</li>
<li>Enable Hyper-V and Hypervisor</li>
</ul>
<hr>
</section>
<section id="ubuntu-live-server" class="level3">
<h3 class="anchored" data-anchor-id="ubuntu-live-server">Ubuntu Live Server</h3>
<ul>
<li><a href="https://ubuntu.com/download/server">Download Ubuntu Live Server iso from here</a></li>
<li>Recommend LTS version (currently 22.04)</li>
<li>Open Hypervisor… Quick Create.. Select .iso file</li>
</ul>
<p>Enter the VM launch settings:</p>
<ul>
<li>4-8gb RAM</li>
<li>10-25gb HDD (depends how many worlds or mods you want)</li>
<li>Enable network adapter (WIFI for local network IP, Default for internet-facing IP)</li>
<li>Click start</li>
</ul>
<p>Ubuntu Installation settings:</p>
<ul>
<li>English/English</li>
<li>Enable dynamic RAM</li>
<li>Click remove the ‘CD/DVD Drive’ in Hyper-V, click continue on installer if you get the red error message</li>
<li>Install third-party packages</li>
<li>Eventually installing Ubuntu Server is completed, Reboot</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Install-Ubuntu-Server.png" class="img-fluid figure-img"></p>
<figcaption>Installation in the Hyper-V</figcaption>
</figure>
</div>
<p>After installation:</p>
<ul>
<li>Login with root user/password</li>
</ul>
<pre><code>sudo apt install wget net-tools
sudo apt update</code></pre>
<hr>
</section>
<section id="ubuntu-firewall" class="level3">
<h3 class="anchored" data-anchor-id="ubuntu-firewall">Ubuntu firewall</h3>
<ul>
<li>Setup UFW firewall rules to allow only traffic on SSH (22) and the default Minecraft (25565) ports:</li>
</ul>
<pre><code># sudo ufw --version
# sudo apt-get install ufw

sudo ufw default deny

sudo ufw allow from 192.168.1.0/24 to any port 22 
#only open to local network

sudo ufw allow from 192.168.1.0/24 to any port 25565    
#only open to local network

sudo ufw enable

# Command may disrupt existing ssh connections. Proceed with operation (y|n)? yENTER

ufw status verbose
ufw reload </code></pre>
<hr>
</section>
<section id="ssh" class="level3">
<h3 class="anchored" data-anchor-id="ssh">SSH</h3>
<ul>
<li><p>Connect via SSH with <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">PuTTY</a> with IP and password on port 22</p></li>
<li><p>Why bother? because using HyperV the copy-and-paste doesn’t work on Ubuntu Live Server VM, even with Guest Service enabled</p></li>
<li><p>Alternatively, generate a new ssh key in the terminal, and export ssh keys and use those to connect</p></li>
</ul>
<pre><code>ssh-keygen</code></pre>
</section>
</section>
<section id="create-new-root-account" class="level2">
<h2 class="anchored" data-anchor-id="create-new-root-account">Create new root account</h2>
<pre><code>sudo -su root

adduser minecraft

usermod -aG sudo minecraft

su - minecraft</code></pre>
<hr>
<section id="system-hardening" class="level3">
<h3 class="anchored" data-anchor-id="system-hardening">System hardening</h3>
<p>Enable SWAP, to allow the system to use more memory/ram if required</p>
<pre><code>sudo swapon -s

sudo fallocate -l 4g /swap

sudo chmod 0600 /swap

sudo mkswap /swap

sudo swapon /swap

sudo echo '/swap    none swap defaults 0 0' | sudo tee -a /etc/fstab

sudo free -m</code></pre>
<p>Change the initial root password to a private and strong one, such as r00tyHafs3t334vM%2ka$8E3:</p>
<pre><code>sudo echo 'root:r00tyHafs3t334vM%2ka$8E3' | sudo chpasswd &amp;&amp; history -d -1</code></pre>
<p>Create a non-root user account with sudo privileges, such as mcninja, and then also set up a strong password for it, such as sud04QeXaedgad3435gae#6&amp;Cw:</p>
<pre><code>sudo useradd -ms /bin/bash mcninja

sudo echo 'mcninja:sud04QeXaedgad3435gae#6&amp;Cw' | sudo chpasswd &amp;&amp; history -d -1

sudo echo 'mcninja    ALL=(ALL)   NOPASSWD: ALL' | sudo tee -a /etc/sudoers.d/designated

sudo chmod 0440 /etc/sudoers.d/designated</code></pre>
<p>At this point it is <em>probably</em> safe to delete any other accounts you have set up with less-secure passwords</p>
<p><strong>Update the system, and then reboot:</strong></p>
<pre><code>sudo apt update

sudo apt upgrade -y

sudo apt autoremove -y

sudo shutdown -r now</code></pre>
<hr>
</section>
<section id="java" class="level3">
<h3 class="anchored" data-anchor-id="java">Java</h3>
<p>Minecraft Java Edition server 1.18.2 requires Java 17.</p>
<pre><code>sudo add-apt-repository ppa:openjdk-r/ppa

sudo apt update

sudo apt install openjdk-17-jre-headless -y

java --version</code></pre>
<hr>
</section>
<section id="minecraft-server" class="level3">
<h3 class="anchored" data-anchor-id="minecraft-server">Minecraft Server</h3>
<ul>
<li><a href="https://www.minecraft.net/en-us/download/server">Find latest minecraft server</a></li>
</ul>
<pre><code>sudo mkdir /opt/minecraft

sudo chown mcninja:mcninja /opt/minecraft

cd /opt/minecraft

sudo wget https://piston-data.mojang.com/v1/objects/8f3112a1049751cc472ec13e397eade5336ca7ae/server.jar -O minecraft_server.1.19.4.jar

echo "eula=true" &gt; /opt/minecraft/eula.txt
</code></pre>
<hr>
</section>
<section id="supervisor" class="level3">
<h3 class="anchored" data-anchor-id="supervisor">Supervisor</h3>
<pre><code>sudo apt install supervisor -y

supervisord -v</code></pre>
<p><strong>Start the Supervisor service:</strong></p>
<pre><code>sudo systemctl daemon-reload

sudo systemctl start supervisor.service

sudo systemctl enable supervisor.service</code></pre>
<p>Create a Supervisor configuration file for the Minecraft Java Edition server:</p>
<pre><code>sudo nano /etc/supervisor/conf.d/minecraft.conf</code></pre>
<p>Populate the file with:</p>
<pre><code>[program:minecraft]

directory=/opt/minecraft/

command=java -Xms1024M -Xmx4G -jar /opt/minecraft/minecraft_server.1.19.4.jar nogui

user=mcninja

autostart=true

autorestart=true

stderr_logfile=/var/log/supervisor/error_minecraft.log

stderr_logfile_maxbytes=100MB

stdout_logfile=/var/log/supervisor/out_minecraft.log

stdout_logfile_maxbytes=100MB
</code></pre>
<p>Load the Minecraft Java Edition server configuration file:</p>
<pre><code>sudo supervisorctl reread

sudo supervisorctl update</code></pre>
<p>Determine if the Minecraft Java Edition server is up and running:</p>
<pre><code>tail -f /var/log/supervisor/out_minecraft.log</code></pre>
<hr>
</section>
</section>
<section id="screens" class="level2">
<h2 class="anchored" data-anchor-id="screens">Screens</h2>
<p>Use Screens to manage several processes (e.g.&nbsp;chat log, server log, updating settings, updates):</p>
<pre><code>sudo apt install screen
screen -S "Minecraft Server"

screen -list</code></pre>
<p>To exit the screen session, press CTRL + A then D. To resume the screen session, run:</p>
<pre><code>screen -r XXXX  # to resume a screen</code></pre>
<hr>
<section id="test-it-works" class="level3">
<h3 class="anchored" data-anchor-id="test-it-works">Test it works!</h3>
<p>Direct connect on the local ip address: 192.168.0.XX</p>
<p>Change the server settings</p>
<pre><code>sudo nano /opt/minecraft/server.properties</code></pre>
</section>
</section>
</section>
<section id="edit-settings-if-required-before-launch" class="level1">
<h1>Edit settings if required before launch</h1>
<p>Let’s take a closer look at some of the most important properties in this list:</p>
<ul>
<li>difficulty (default easy) - This sets the difficulty of the game, such as how much damage is dealt and how the elements affect your player. The options are peaceful, easy, normal, and hard.</li>
<li>gamemode (default survival) - This sets the gameplay mode. The options are survival, creative,adventure, and spectator.</li>
<li>level-name (default world) - This sets the name of your server that will appear in the client. Special characters such as apostrophes may need to be preceded by a backslash. This is known is escaping characters, and is common practice when special characters may not otherwise be parsed correctly in context.</li>
<li>motd (default A Minecraft Server) - The message that is displayed in the server list of the Minecraft client.</li>
<li>pvp (default true) - Enables Player versus Player combat. If set to true, players will be able to engage in combat and damage each other.</li>
<li>online-mode - True enables non-premium players to log in to your Minecraft server</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HyperVM.png" class="img-fluid figure-img"></p>
<figcaption>Start / Stop your Minecraft Server in HyperVisor</figcaption>
</figure>
</div>
<hr>
<section id="internet-server" class="level2">
<h2 class="anchored" data-anchor-id="internet-server">Internet server</h2>
<p>It would probably be possible to open the VM to the internet securely, by changing the VM Network to Default, then changing the UFW firewall settings</p>
<pre><code>sudo ufw allow 22 # open VM SSH to internet traffic
sudo ufw allow 25565 #open port to internet traffic</code></pre>
<p>It is maybe/probably possible to route minecraft traffic maybe open ipv4 port forward on the router settings, or use an ipv6 pin hole port. Even, maybe get a cheap/free domain to point at the server and fix the IP address for the machine.</p>
<p>At this point, though, given the additional security effort required and cost it would probably be worth just buying a paid-for and ready-to-use Minecraft server. Or following the above process on AWS using EC2 Small/Medium size Ubuntu server.</p>
</section>
<section id="sources" class="level2">
<h2 class="anchored" data-anchor-id="sources">Sources</h2>
<ul>
<li><a href="https://www.vultr.com/docs/how-to-install-a-minecraft-server-on-debian-11/">https://www.vultr.com/docs/how-to-install-a-minecraft-server-on-debian-11/</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-minecraft-server-on-ubuntu-22-04">https://www.digitalocean.com/community/tutorials/how-to-create-a-minecraft-server-on-ubuntu-22-04</a></li>
<li><a href="https://www.vultr.com/docs/how-to-install-a-minecraft-server-on-ubuntu-20-04/">https://www.vultr.com/docs/how-to-install-a-minecraft-server-on-ubuntu-20-04/</a></li>
</ul>
<p><br></p>
<hr>
<section id="if-you-found-this-useful-post-a-thumbs-up-below" class="level3">
<h3 class="anchored" data-anchor-id="if-you-found-this-useful-post-a-thumbs-up-below">If you found this useful post a thumbs up below</h3>
<script src="https://giscus.app/client.js" data-repo="thomashallam/thomashallam.github.io" data-repo-id="R_kgDOIW_M2g" data-category="General" data-category-id="DIC_kwDOIW_M2s4CSpZr" data-mapping="url" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="dark_protanopia" data-lang="en" data-loading="lazy" crossorigin="anonymous" async="">
</script>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>